<ion-header>
  <ion-toolbar>
    <ion-title>Sélectionner un post</ion-title>
    <ion-buttons slot="start">
      <ion-button (click)="dismiss()" fill="clear">
        <ion-icon name="close" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
    <ion-buttons slot="end" *ngIf="selectedPost">
      <ion-button (click)="confirmSelection()" fill="clear" color="primary">
        <ion-icon name="checkmark" slot="icon-only"></ion-icon>
      </ion-button>
    </ion-buttons>
  </ion-toolbar>
</ion-header>

<ion-content>
  <!-- Barre de recherche -->
  <ion-searchbar
    [(ngModel)]="searchTerm"
    (ionInput)="filterPosts()"
    placeholder="Rechercher un post..."
    animated="true">
  </ion-searchbar>

  <!-- Loading state -->
  <div *ngIf="isLoading" class="loading-container">
    <ion-spinner name="crescent"></ion-spinner>
    <p>Chargement des posts...</p>
  </div>

  <!-- Liste des posts -->
  <div *ngIf="!isLoading" class="posts-container">
    <!-- Aucun post trouvé -->
    <div *ngIf="filteredPosts.length === 0" class="empty-state">
      <ion-icon name="image" size="large"></ion-icon>
      <h3 *ngIf="userPosts.length === 0">Aucun post disponible</h3>
      <h3 *ngIf="userPosts.length > 0">Aucun post trouvé pour "{{searchTerm}}"</h3>
      <p *ngIf="userPosts.length === 0">Cet utilisateur n'a pas encore publié de contenu.</p>
    </div>

    <!-- Grid des posts -->
    <ion-grid>
      <ion-row>
        <ion-col 
          size="6" 
          size-md="4" 
          size-lg="3" 
          *ngFor="let post of filteredPosts; trackBy: trackByPostId">
          <div 
            class="post-item" 
            [class.selected]="selectedPost?.id === post.id"
            (click)="selectPost(post)">
            
            <!-- Media thumbnail -->
            <div class="post-thumbnail">
              <img 
                [src]="(post.thumbnailUrl || post.fileUrl | mediaUrl)" 
                [alt]="post.description || 'Post image'"
                (error)="onImageError($event)"
                loading="lazy">
              
              <!-- Icône vidéo pour les vidéos -->
              <div *ngIf="isVideo(post)" class="video-overlay">
                <ion-icon name="play"></ion-icon>
              </div>

              <!-- Badge de sélection -->
              <div *ngIf="selectedPost?.id === post.id" class="selection-badge">
                <ion-icon name="checkmark"></ion-icon>
              </div>
            </div>

            <!-- Informations du post -->
            <div class="post-info">
              <p class="post-description" *ngIf="post.description">
                {{post.description | slice:0:50}}{{post.description.length > 50 ? '...' : ''}}
              </p>
              
              <!-- Statistiques -->
              <div class="post-stats">
                <span class="stat-item">
                  <ion-icon name="eye" size="small"></ion-icon>
                  {{post.viewCount | shortNumber}}
                </span>
                <span class="stat-item" *ngIf="post.likeCount > 0">
                  <ion-icon name="heart" size="small"></ion-icon>
                  {{post.likeCount | shortNumber}}
                </span>
              </div>

              <!-- Date -->
              <div class="post-date">
                {{post.createdAt | date:'shortDate'}}
              </div>
            </div>
          </div>
        </ion-col>
      </ion-row>
    </ion-grid>
  </div>
</ion-content>

<!-- Footer avec bouton de confirmation -->
<ion-footer *ngIf="selectedPost">
  <ion-toolbar>
    <ion-button 
      expand="block" 
      fill="solid" 
      color="primary"
      (click)="confirmSelection()">
      <ion-icon name="checkmark" slot="start"></ion-icon>
      Sélectionner ce post
    </ion-button>
  </ion-toolbar>
</ion-footer>
